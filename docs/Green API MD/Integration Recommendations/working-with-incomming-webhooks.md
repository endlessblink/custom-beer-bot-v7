# Working with incoming webhooks#

Original URL: https://green-api.com/en/docs/api/recommendations/working-with-incomming-webhooks/

green-api/issues Home Documents Documents Index Quick start Quick start Before you start Plans Execute requests Postman collection API documents API documents Overview Account Account Account - overview Get instance settings Set instance settings Get instance state Reboot instance Logout instance Get QR code Get QR code via websocket Link with phone number Set profile picture Get WhatsApp account information Archive Archive Get instance connection status Sending Sending Sending - overview Send text Send Poll Send video, audio, image, document Send video, audio, image, document via URL Upload file Send location Send contact Forward messages Archive Archive Send Buttons Send Template Buttons Send List Message Receiving Receiving Conception HTTP API HTTP API HTTP API technology Receive notification Delete notification Webhook Endpoint Webhook Endpoint Webhook Endpoint technology Incoming notifications format Incoming notifications format Overview Incoming message Incoming message Incoming messages Incoming text message Incoming text message or URL message Incoming image, video, audio, document message Incoming location message Incoming contact message Incoming contacts array message Incoming buttons message Incoming selection list message Incoming template buttons message Incoming sticker message Incoming reaction message Group invitation incoming message Incoming poll message Incoming poll update message Selecting buttons Selecting buttons Simple button selection Template button selection List element selection Outgoing message Outgoing message Message sent from phone Message sent via API Outgoing message status Others Others Instance status Instance socket status Incoming call Exceeding limitation on plan Objects Objects Incoming webhooks types Archive Archive Quoted message Device status Contact avatar Incoming block Get files Get files Download file from incoming message Journals Journals Journals - review Get chat history Get chat message Get incoming messages journal Get outgoing messages journal Queues Queues Queues - overview Show messages queue Clear messages queue Groups Groups Groups - overview Create group Change group name Get group data Add group participant Delete group participant Set group admin rights Remove group admin rights Set group picture Leave group Statuses (Î²-version) Statuses (Î²-version) Statuses - overview Statuses Statuses Send text status Send voice status Send media status Delete status Statistics Statistics Get status statistic History History Get incoming statuses Get outgoing statuses Read mark Read mark Read mark - overview Mark chat as read Service methods Service methods Service methods - overview Check WhatsApp availability Get avatar Get contacts Get Contact Info Delete message Archive Chat UnarchiveChat Change the settings of disappearing chat messages Others Others Chat Id Messages sending delay Common errors Reaching the limits on the Developer plan Integration Recommendations Integration Recommendations Integration Recommendations - overview Creating and configuring an instance Ð¡reating and configuring an instance using the partner key Connecting a phone number to the GREEN API service Tracking the state of an instance Working with incoming calls Using GREEN API Hosts Working with incoming webhooks Working with incoming webhooks Table of contents 1. Receiving incoming notifications Working with HTTP API Working with Webhook Endpoint 2. Processing incoming notifications 3. Security when receiving notifications 4. Logging and error handling 5. Scaling and load balancing Manual deployment on different servers or virtual machines: Using containerization with Docker: Using cloud providers: Rate limiter Archive Archive Device (phone) Device (phone) Device - overview Get device info Partners Partners Overview Get the list of all instances Create instance Delete instance Console Console Overview Registration FAQ FAQ FAQ Mobile App Mobile App How to install the GREEN-API app on Android? How to properly use materials from the GREEN-API on another website? How to properly use materials from the GREEN-API on another website? How to properly use materials from the GREEN-API on another website? WhatsApp features WhatsApp features What are the features of sending and receiving messages to numbers of different countries? How to text on WhatsApp first? How to set up device pairing? How to display company name and logo in chats? How to format text and use control characters? How to send emoji or other symbol via the API? How to run a VBA query? How to confirm the security code in WhatsApp? How to use polls as buttons? How to use a proxy server in WhatsApp? How to transfer your WhatsApp account to another phone? How to use the click to chat feature? How to make links in messages active? What are the statuses of messages in WhatsApp? How to identify your WhatsApp subscribers? How to get a green check mark in WhatsApp? How to protect personal data? How to register phone number on WhatsApp? How to log incoming calls in WhatsApp? Working with files via API Working with files via API How to send file by sendFileByUrl method using external storage? How to send a file? What file types does the API support? WhatsApp Errors WhatsApp Errors Why are incoming notifications slow (webhooks)? What to do with the error "WhatsApp is temporarily unavailable. Try again in 1 hour."? Why can not I connect the device to the API? What to do when receiving yellowCard status? Why is logout happening? Why messages are sent slowly? Why is the message status "sent"? What to do when receiving the error "Maximum number of devices connected"? Why does the SWE001 error often occur? Why are members not being added to the group? How can I prevent a QR session from being permanently disconnected? What to do when you receive a "Message Waiting" notification? Why can`t I download or update WhatsApp? Account blocking Account blocking How to protect number from ban? What to do if your instance is locked? What to do if your number is blocked? Why is re-blocking happening? How to make mailings without the risk of blocking? How to implement mailings via CRM? How does the use of the WA Business application affect the risk of blocking? Is there liability for messaging on WhatsApp if Meta Platforms Inc is prohibited in Russia? How to determine if WhatsApp has unblocked my number? What types of blocks can WhatsApp impose? How my WhatsApp number is protected from blocking? SDK Chatbots Integrations Releases Blog News FAQ Table of contents 1. Receiving incoming notifications Working with HTTP API Working with Webhook Endpoint 2. Processing incoming notifications 3. Security when receiving notifications 4. Logging and error handling 5. Scaling and load balancing Manual deployment on different servers or virtual machines: Using containerization with Docker: Using cloud providers: Working with incoming webhooks# Receiving incoming data in the GREEN API is implemented through incoming notifications. There are 2 ways to receive notifications HTTP API and Webhook Endpoint. Below are recommendations for working with webhooks and notifications: Receive incoming notifications Processing incoming notifications Security when receiving notifications Logging and error handling Scaling and load balancing 1. Receiving incoming notifications# Working with HTTP API# When working via HTTP API methods, you need to call 2 API methods sequentially: Calling the method receiveNotification depending on the presence of messages, method settings and instance settings in the response. You will receive an object with a number and a notification object. If there are no notifications in the queue, the response will be null. After receiving a notification, you need to process the incoming notification with a handler and delete the notification using the deleteNotification method by passing the number of this notification. If the method terminated with a status code of 500 or more, the method request must be repeated. Working with Webhook Endpoint# During the work with Webhook Endpoint methods, you need to configure a web server that is able to accept HTTP requests. Web server must be able: Accept incoming POST requests (webhook) Process an incoming notification. Return a response with status code 200 (after receiving status code 200 from the server, the notification will be removed from the queue). The waiting time for a response from your web server is 180 seconds; if the server does not return status code 200, the GREEN API server will pause for 60 seconds and resend the current notification. 2. Processing incoming notifications# All the types and formats of notifications are specified in the documentation. It is recommended to process incoming notifications according to the instructions below: After receiving a notification by the handler service, it is advisable to check the notification scheme (JSONSchema). It is not recommended to check the schema for additional fields, since the API may expand by adding new functions and information. If you receive a notification in which a field is missing or its format is incorrect, you need to record such a notification in the logging system and inform the operator by indicating this notification, this will help record and understand the error in the future. The handler service must find the required typeWebhook field and, depending on its type, process or reset the notification. After processing the notification, the handler must return status code 200. This way, all notifications that are not processed for you will be removed from the queue and subsequent notifications will arrive correctly. If you do not use certain types of notifications, we recommend resetting unnecessary notifications by giving status code 200, this way you will eliminate handler errors and when new functionality is released you will not have problems with the integration. The example of a simple server from GREEN API: Python with an installation instruction. Golang with an installation instruction. NodeJS with an installation instruction. 3. Security when receiving notifications# During the design of the service it is important to pay attention to security. When working with HTTP API technology, your IP address is private and not accessible to other Internet users; this technology works well in small systems with a small amount of data. When working with Webhook Endpoint technology, your IP address is accessible to another user, it is necessary to exclude harmful influences on your system from the outside. Security recommendations during the usage of the Webhook Endpoint technology: Set up a firewall and allow access to the server only from the IP addresses you require. Restricting access only from certain IP addresses. You can configure your web server to accept incoming requests only from GREEN API IP addresses. Use an authorization token when sending notifications. Specify the authorization token in the webhookUrlToken field via console or using the setSettings method. Example IP address filtering code in python from flask import Flask, request from datetime import datetime import json app = Flask(**name**) # List of Green Api IP addresses ALLOWED_IPS = [ "51.250.84.44", "51.250.94.65", "51.250.89.177", "64.226.125.75", "158.160.49.84", "46.101.109.139", "51.250.95.149", "51.250.12.167", "209.38.202.24"] # Function to check allowed IP addresses def check_ip(): client_ip = request.remote_addr if client_ip not in ALLOWED_IPS: return False return True @app.before_request def before_request(): if not check_ip(): return "Access Denied", 403 # The rest of your application code... if **name** == "**main**": app.run() 4. Logging and error handling# It is recommended to set up a logging system: Use a multi-level custom logging system. Log schema problems at the ERROR level, new notification types at the WARN level, unprocessed message types at the DEBUG level, and system operation at the INFO level. By turning on the required level of logging, you will be able to debug the system and identify all problems associated with integration. It is recommended to inform the operator about unknown types of notifications and notification errors; this will allow the problem to be localized as quickly as possible and will provide more information to the operator without missing notification types that are not yet supported by the integration. Be sure to log notification data; the record must contain information including the date and time of receipt - timestamp, notification type - typeWebhook and other notification data. This will allow you to analyze the operation under unexpected scenarios of system operation. 5. Scaling and load balancing# As you increase the size of your system, you may encounter scaling issues. It is recommended to scale the system by distributing the load across several handler microservices; for this you can use a load balancer. As an example of a balancer, let's use the nginx web server. You can use several instances of your server and distribute the load between them using nginx. Nginx is a high-performance web server that can also be used as a load balancer (the process of distributing web traffic evenly across multiple servers) , preventing one server from being overloaded. Nginx uses various algorithms to optimally distribute traffic and can be configured to ensure system reliability when one or more servers fail. Use one of the following methods to deploy multiple server instances: Manual deployment on different servers or virtual machines:# Create or rent multiple physical servers, virtual machines or containers. Configure each server to contain a copy of your application. Using containerization with Docker:# Create a Docker image of your application. Run multiple containers with this image on one or more host machines. Using cloud providers:# Deploy multiple instances of your server on a cloud provider platform such as Amazon Web Services (AWS), Google Cloud Platform (GCP) or Microsoft Azure. Use cloud infrastructure management tools to automate server deployment and scaling. Example nginx configuration file for load balancer http { upstream app{ server 10.2.0.100; server 10.2.0.101; server 10.2.0.102; } // This server accepts all traffic on port 80 and forwards it upstream. // Please note that the upstream name and proxy_pass must be the same. server { listen 80; server_name mydomain.com; location / { include proxy_params; proxy_pass http://app; proxy_redirect off; proxy_http_version 1.1; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection "upgrade"; } } }