# פונקציונליות נוכחית - חשוב לשמר!

מסמך זה מתעד את כל הפונקציונליות הנוכחית בבוט סיכום הוואטסאפ. כל הפיצ'רים המתוארים כאן **חייבים להישמר** בכל גרסה עתידית של המערכת.

## רכיבי ליבה שחייבים להישמר

1. **תפריט אינטראקטיבי** - הממשק המשתמש הבסיסי שמאפשר ניווט וגישה לכל הפונקציונליות.
2. **יכולות סיכום הודעות** - היכולת לאסוף ולסכם הודעות מקבוצות וואטסאפ.
3. **מידע דיאגנוסטי** - האפשרות לראות לוגים ולבצע בדיקות חיבור.
4. **ניהול הגדרות** - השמירה וטעינה של הגדרות משתמש.
5. **תמיכה בצפייה בסיכומים קודמים** - האפשרות לצפות בסיכומים שנוצרו בעבר (כשמסד נתונים זמין).
6. **מנגנוני בטיחות לשליחת הודעות** - המנגנונים שמונעים שליחת הודעות בלתי מורשית.

## מבנה הקוד הנוכחי

המבנה הארכיטקטוני הנוכחי עובד היטב ויש לשמור עליו:

```
.
├── config/                  # ניהול הגדרות
├── green_api/               # ממשק מול Green API
│   ├── client.py            # לקוח API בסיסי
│   └── group_manager.py     # ניהול קבוצות
├── llm/                     # ממשק מול מודלי שפה
│   └── openai_client.py     # חיבור ל-OpenAI
├── processor/               # עיבוד הודעות
│   └── message_processor.py # מעבד הודעות גולמיות
├── db/                      # אחסון נתונים (Supabase)
│   └── supabase_client.py   # לקוח מסד נתונים
├── utils/                   # כלים שימושיים
│   ├── logger.py            # מערכת לוגים
│   └── menu/                # מודול התפריט (קריטי)
│       ├── core_menu.py     # פונקציות תפריט בסיסיות
│       └── test_menu.py     # בדיקות אוטומטיות לתפריט
├── main.py                  # הפעלה ראשית כשירות רקע
├── summary_menu.py          # תפריט אינטראקטיבי
└── generate_summary.py      # סקריפט עצמאי לייצור סיכומים
```

## פיצ'רים שחייבים להישמר ולעבוד

### 1. יכולת הפעלה ללא מסד נתונים
המערכת צריכה להמשיך לתפקד גם כאשר אין חיבור לסופאבייס, עם הגבלות הגיוניות בפונקציונליות.

### 2. אפשרויות תפריט תמיד זמינות
כל אפשרויות התפריט (1-5) צריכות תמיד להיות מוצגות, גם אם חלק מהן אינן זמינות בגלל רכיבים חסרים.

### 3. איסוף ועיבוד הודעות
איסוף הודעות מקבוצות, עיבוד ההודעות והצגת מידע דיאגנוסטי על ההודעות במצב Debug.

### 4. יצירת סיכומים עם OpenAI
יכולת לשלוח הודעות מעובדות ל-OpenAI ולקבל סיכום מובנה.

### 5. ניהול הגדרות
יכולת להציג ולשנות הגדרות, כולל בחירת קבוצה מועדפת ומודל OpenAI.

### 6. מצב דיבוג
אפשרויות לבדיקת חיבורים, צפייה בלוגים וייצוא נתוני הודעות לצורך דיבוג.

### 7. השבתת שליחת הודעות
מנגנוני הבטיחות להשבתת שליחת הודעות חייבים להישאר על מנת למנוע שליחה בשוגג.

## ממשקים חיצוניים

הבוט תלוי במספר שירותים חיצוניים, וממשקים אלו צריכים להישמר:

1. **Green API** - להתחברות לוואטסאפ, קבלת הודעות, רשימת קבוצות.
2. **OpenAI API** - ליצירת סיכומים.
3. **Supabase** (אופציונלי) - לאחסון הודעות וסיכומים.

## התנהגות במקרה של שגיאות

הטיפול בשגיאות הנוכחי פועל היטב ויש לשמרו:

1. המשך פעולה גם כאשר חלק מהרכיבים נכשלים.
2. הצגת הודעות שגיאה ברורות למשתמש.
3. תיעוד מפורט של שגיאות בקבצי לוג.
4. מניעת קריסה של התוכנית בעקבות שגיאות לא צפויות.

## טכניקות לבדיקה ווידוא תקינות

1. הפעל את `utils/menu/test_menu.py` כדי לוודא שמודול התפריט פועל כראוי.
2. השתמש במצב דיבוג בתפריט הראשי כדי לוודא חיבורים תקינים.
3. נסה ליצור סיכום ללא שליחתו כדי לבדוק את תהליך הסיכום.
4. בדוק את מצב הלוגים בתיקיית `debug_logs`.

## הערות לפיתוח עתידי

בעת הוספת פיצ'רים חדשים, יש להקפיד על:

1. לא לשבור פונקציונליות קיימת.
2. לשמור על המבנה הארכיטקטוני הנוכחי.
3. לבדוק תאימות עם כל הרכיבים הקיימים.
4. לשמור על עקרונות הטיפול בשגיאות ומניעת קריסות.
5. לתעד כראוי כל שינוי או תוספת.

---

**חשוב:** מסמך זה אמור להתעדכן בכל פעם שמתווספת פונקציונליות חדשה או משתנה פונקציונליות קיימת. 