# סקריפטים לניהול ובדיקת החיבור ל-WhatsApp

קובץ זה מכיל הוראות לשימוש בסקריפטים שנועדו לבדוק ולפתור בעיות בחיבור ל-WhatsApp באמצעות Green API.

## 1. בדיקת מצב ה-Webhook (`check_webhook.py`)

סקריפט זה בודק את מצב ה-webhook והגדרות ה-Green API.

```bash
python check_webhook.py
```

הסקריפט יציג:
- אם המופע מאושר
- הגדרות ה-webhook הנוכחיות
- אם ה-webhook מופעל
- המלצות לפתרון בעיות

## 2. הפעלת ה-Webhook (`enable_webhook.py`)

סקריפט זה מאפשר לך להפעיל את ה-webhook ולעדכן את כתובת ה-URL שלו.

```bash
python enable_webhook.py
```

הסקריפט:
- מציג את הגדרות ה-webhook הנוכחיות
- מאפשר לך לשנות את כתובת ה-URL של ה-webhook
- מפעיל את ה-webhook
- בודק את חיבור ה-webhook

## 3. משיכת הודעות ידנית (`fetch_new_messages.py`)

סקריפט זה מושך הודעות חדשות מ-WhatsApp ומאחסן אותן במסד הנתונים.

```bash
python fetch_new_messages.py
```

הסקריפט:
- בודק את ההודעה האחרונה במסד הנתונים
- משתמש במזהה הקבוצה המוגדר בקובץ הגדרות (או בקובץ .env)
- מושך הודעות חדשות מ-WhatsApp
- מעבד ושומר רק הודעות שטרם נשמרו במסד הנתונים

## 4. בדיקת חיבור ל-Green API (`check_green_api.py`)

סקריפט זה בודק את החיבור ל-Green API ומנסה למשוך הודעות אחרונות.

```bash
python check_green_api.py
```

הסקריפט:
- בודק את ההודעות האחרונות במסד הנתונים
- בודק את הסיכום האחרון שנוצר
- מנסה למשוך הודעות מ-Green API
- בודק אם יש הודעות חדשות שלא נמצאות במסד הנתונים

## פתרון בעיות נפוצות

1. **הוק ווב לא מקבל הודעות:**
   - ודא שה-webhook מופעל באמצעות `enable_webhook.py`
   - ודא שכתובת ה-URL של ה-webhook נכונה ונגישה מהאינטרנט
   - בדוק את הלוגים של השרת שמקבל את הוק הווב

2. **הבוט לא מעדכן את ההודעות:**
   - הרץ `fetch_new_messages.py` למשיכת הודעות חדשות באופן ידני
   - ודא שמזהה הקבוצה נכון
   - בדוק את הלוגים לאיתור שגיאות

3. **הסיכומים זהים או לא מעודכנים:**
   - ודא שיש הודעות חדשות במסד הנתונים
   - הרץ `fetch_new_messages.py` למשיכת הודעות חדשות
   - בדוק את הגדרות הסיכום בקוד

## אוטומציה

אם ה-webhook לא עובד כראוי, תוכל להגדיר משימה מתוזמנת להרצת `fetch_new_messages.py` באופן שגרתי:

**בלינוקס (cron):**
```
0 */3 * * * cd /path/to/project && python fetch_new_messages.py >> /path/to/logs/fetch.log 2>&1
```

**בווינדוס (Task Scheduler):**
יצירת משימה מתוזמנת שמריצה את הסקריפט כל X שעות. 